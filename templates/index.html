<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Asteroid Impact Simulator</title>

    <!-- Styles -->
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">

    <!-- Leaflet for 2D maps -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />

    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- jsPDF for PDF generation -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
</head>

<body>
    <!-- Header -->
    <header class="main-header">
        <div class="header-content">
            <div class="header-title-container">
                <h1 id="header-title" class="logo">Asteroid Impact Simulator</h1>
                <p class="subtitle">NASA Space Apps 2025</p>
            </div>
            <div class="theme-toggle">
                <button class="mode-btn active" data-mode="simulation">
                    <span class="btn-text-full">Simulaci√≥n de Impacto</span>
                    <span class="btn-text-short">Simulaci√≥n</span>
                </button>
                <button class="mode-btn" data-mode="mitigation">
                    <span class="btn-text-full">Estrategias de Mitigaci√≥n</span>
                    <span class="btn-text-short">Mitigaci√≥n</span>
                </button>
                <button class="mode-btn" data-mode="rewards">Recompensas</button>
                <button id="theme-toggle-btn" class="theme-toggle-btn" title="Cambiar tema">
                    <span class="theme-icon">‚óê</span>
                </button>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <div class="main-content">
        <!-- Sidebar Toggle Button -->
        <button class="sidebar-toggle" id="sidebar-toggle" title="Abrir/cerrar panel">
            <span>‚ò∞</span>
        </button>
        
        <!-- Sidebar Overlay -->
        <div class="sidebar-overlay" id="sidebar-overlay"></div>
        
        <!-- Sidebar -->
        <aside class="sidebar" id="sidebar">
            <!-- Bento Dashboard -->
            <div class="bento-dashboard">
                <!-- Card 1: Impact Energy -->
                <div class="bento-card energy-card">
                    <div class="card-header">
                        <h3>Energ√≠a de Impacto</h3>
                        <span class="card-icon">üí•</span>
                    </div>
                    <div class="card-metric" id="impact-energy">0 MT</div>
                    <div class="card-trend" id="energy-trend">
                        <span class="trend-icon">‚ö°</span>
                        <span class="trend-text">Equivalente a bombas nucleares</span>
                    </div>
                </div>

                <!-- Card 2: Crater Size -->
                <div class="bento-card crater-card">
                    <div class="card-header">
                        <h3>Tama√±o del Cr√°ter</h3>
                        <span class="card-icon">üï≥Ô∏è</span>
                    </div>
                    <div class="card-metric" id="crater-diameter">0 km</div>
                    <div class="card-subtitle">Di√°metro estimado</div>
                </div>

                <!-- Card 3: Affected Population -->
                <div class="bento-card population-card">
                    <div class="card-header">
                        <h3>Poblaci√≥n Afectada</h3>
                        <span class="card-icon">üë•</span>
                    </div>
                    <div class="card-metric" id="affected-population">0</div>
                    <div class="card-trend" id="population-trend">
                        <span class="trend-icon">üìä</span>
                        <span class="trend-text">Personas en zona de riesgo</span>
                    </div>
                </div>


                <!-- Card 5: Asteroid Speed -->
                <div class="bento-card speed-card">
                    <div class="card-header">
                        <h3>Velocidad del Asteroide</h3>
                        <span class="card-icon">üöÄ</span>
                    </div>
                    <div class="card-metric" id="asteroid-speed">0 km/s</div>
                    <div class="card-subtitle">Velocidad de entrada</div>
                </div>

                <!-- Card 6: Destruction Radius -->
                <div class="bento-card radius-card">
                    <div class="card-header">
                        <h3>Radio de Destrucci√≥n</h3>
                        <span class="card-icon">üíÄ</span>
                    </div>
                    <div class="card-metric" id="destruction-radius">0 km</div>
                    <div class="card-trend" id="radius-trend">
                        <span class="trend-icon">üî•</span>
                        <span class="trend-text">Zona de destrucci√≥n total</span>
                    </div>
                </div>

                <!-- Card 7: Tsunami Risk -->
                <div class="bento-card tsunami-card">
                    <div class="card-header">
                        <h3>Riesgo de Tsunami</h3>
                        <span class="card-icon">üåä</span>
                    </div>
                    <div class="card-metric" id="tsunami-risk">Bajo</div>
                    <div class="card-subtitle">Si impacta en oc√©ano</div>
                </div>

                <!-- Card 8: Seismic Activity -->
                <div class="bento-card seismic-card">
                    <div class="card-header">
                        <h3>Actividad S√≠smica</h3>
                        <span class="card-icon">üåç</span>
                    </div>
                    <div class="card-metric" id="seismic-magnitude">0.0</div>
                    <div class="card-subtitle">Magnitud Richter</div>
                </div>

                 <!-- Card 9: Most Affected Fauna -->
                 <div class="bento-card fauna-card">
                     <div class="card-header">
                         <h3>Fauna M√°s Afectada</h3>
                         <span class="card-icon">ü¶ã</span>
                     </div>
                     <div class="card-metric" id="most-affected-fauna">-</div>
                     <div class="card-subtitle">Especie en mayor riesgo</div>
                 </div>

                 <!-- Card 10: Most Affected Flora -->
                 <div class="bento-card flora-card">
                     <div class="card-header">
                         <h3>Flora M√°s Afectada</h3>
                         <span class="card-icon">üåø</span>
                     </div>
                     <div class="card-metric" id="most-affected-flora">-</div>
                     <div class="card-subtitle">Especie en mayor riesgo</div>
                 </div>
                 
                 <!-- Download PDF Button -->
                 <div class="bento-card pdf-card">
                     <button class="btn-primary" onclick="downloadSimulationPDF()" style="width: 100%; height: 100%; display: flex; flex-direction: row; gap: 1rem; align-items: center; justify-content: center; border: none; background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%); color: white; border-radius: 12px; cursor: pointer; font-weight: 600; transition: all 0.3s ease; box-shadow: 0 4px 15px rgba(231, 76, 60, 0.3);" onmouseover="this.style.transform='scale(1.02)'; this.style.boxShadow='0 6px 20px rgba(231, 76, 60, 0.4)'" onmouseout="this.style.transform='scale(1)'; this.style.boxShadow='0 4px 15px rgba(231, 76, 60, 0.3)'">
                         <span style="font-size: 3rem; line-height: 1;">üìÑ</span>
                         <div style="display: flex; flex-direction: column; align-items: flex-start; gap: 0.25rem;">
                             <span style="font-size: 1.2rem; font-weight: 700; letter-spacing: 0.5px;">Descargar Reporte</span>
                             <span style="font-size: 0.85rem; opacity: 0.9; font-weight: 400;">An√°lisis Completo en PDF</span>
                         </div>
                     </button>
                 </div>
                 
                 <!-- New Simulation Button -->
                 <div class="bento-card new-simulation-card">
                     <button class="btn-primary" onclick="hideBentoDashboard()" style="width: 100%; height: 100%; display: flex; align-items: center; justify-content: center; font-size: 2rem; border: none; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border-radius: 12px; cursor: pointer;">
                         +
                     </button>
                 </div>
            </div>

            <!-- Simulation Controls -->
            <div id="simulation-controls" class="controls-section active">
                <div class="section-title">Par√°metros del Asteroide</div>

                <div class="control-panel">
                    <!-- Location Search -->
                    <div class="control-group">
                        <label for="location-search">Buscar Ubicaci√≥n</label>
                        <div style="display: flex; gap: 0.5rem; align-items: center;">
                            <input 
                                type="text" 
                                id="location-search" 
                                placeholder="Buscar ciudad, pueblo o lugar..."
                                style="flex: 1; background: var(--input-bg); color: var(--text-light); border: 1px solid var(--input-border); padding: 0.625rem 0.75rem; border-radius: 6px; font-size: 0.875rem;"
                                title="Busca cualquier ubicaci√≥n en el mundo"
                            />
                            <button id="search-location-btn" class="btn-secondary" style="padding: 0.75rem 1rem; white-space: nowrap;" title="Buscar ubicaci√≥n">
                                Buscar
                            </button>
                        </div>
                        <div id="location-search-results" style="display: none; margin-top: 0.5rem; max-height: 200px; overflow-y: auto; background: var(--input-bg); border: 1px solid var(--input-border); border-radius: 6px;"></div>
                        <div id="current-location-display" style="margin-top: 0.5rem; font-size: 0.75rem; color: var(--text-medium); display: flex; align-items: center; gap: 0.5rem;">
                            <span style="color: var(--primary-color); font-weight: bold;">‚óè</span>
                            <span id="current-location-text">Cargando ubicaci√≥n...</span>
                        </div>
                    </div>
                    
                    <!-- Asteroid Selection -->
                    <div class="control-group">
                        <label for="asteroid-name">Asteroide Seleccionado</label>
                        <div style="display: flex; gap: 0.5rem; align-items: center;">
                            <input 
                                type="text" 
                                id="asteroid-name" 
                                readonly 
                                placeholder="Personalizado - Usa el explorador para seleccionar"
                                style="flex: 1; cursor: pointer; background: var(--input-bg); color: var(--text-light); border: 1px solid var(--input-border); padding: 0.625rem 0.75rem; border-radius: 6px; font-size: 0.875rem;"
                                title="Haz clic en 'Explorar' para seleccionar un asteroide"
                            />
                            <input type="hidden" id="selected-asteroid-id" value="">
                            <button id="browse-asteroids-btn" class="btn-secondary" style="padding: 0.75rem 1rem; white-space: nowrap;" title="Ver todos los asteroides">
                                Explorar
                            </button>
                        </div>
                    </div>

                    <!-- Diameter -->
                    <div class="control-group">
                        <label for="diameter">Di√°metro (metros)</label>
                        <input type="range" id="diameter" min="10" max="1000" value="150" step="10">
                        <span id="diameter-value" class="value-display">150 m</span>
                    </div>

                    <!-- Velocity -->
                    <div class="control-group">
                        <label for="velocity">Velocidad (km/s)</label>
                        <input type="range" id="velocity" min="5" max="50" value="25" step="1">
                        <span id="velocity-value" class="value-display">25 km/s</span>
                    </div>

                    <!-- Entry Angle -->
                    <div class="control-group">
                        <label for="angle">√Ångulo de Entrada (¬∞)</label>
                        <input type="range" id="angle" min="15" max="90" value="45" step="5">
                        <span id="angle-value" class="value-display">45¬∞</span>
                    </div>

                    <!-- Composicion de asteroide -->
                    <div class="control-group">
                        <label for="composition">Composici√≥n del Asteroide</label>
                        <select id="composition">
                            <option value="rocky">Rocoso (S-type) - Com√∫n</option>
                            <option value="metallic">Met√°lico (M-type) - Denso</option>
                            <option value="carbonaceous">Carbon√°ceo (C-type) - Fr√°gil</option>
                            <option value="icy">Helado (Cometa) - Vol√°til</option>
                        </select>
                    </div>

                    <!-- Impact Location -->
                    <div class="control-group">
                        <label>Punto de Impacto</label>
                        <div class="location-inputs">
                            <input type="number" id="latitude" placeholder="Latitud" min="-90" max="90" value="40.7"
                                step="0.1">
                            <input type="number" id="longitude" placeholder="Longitud" min="-180" max="180"
                                value="-74.0" step="0.1">
                        </div>
                    </div>

                    <button id="simulate-btn" class="btn-primary">Simular Impacto</button>
                </div>

                <!-- Results Preview -->
                <div class="results-preview">
                    <div id="results-content" class="results-content">
                        <div class="placeholder">Ejecute una simulaci√≥n para ver los resultados</div>
                    </div>
                </div>

            </div>

            <!-- Mitigation Controls -->
            <div id="mitigation-controls" class="controls-section">
                <div class="section-title">Estrategia de Deflexi√≥n</div>

                <div class="control-panel">
                    <!-- Strategy Selection -->
                    <div class="control-group">
                        <label for="strategy-select">M√©todo</label>
                        <select id="strategy-select">
                            <option value="kinetic_impactor">Impactador Cin√©tico</option>
                            <option value="gravity_tractor">Tractor de Gravedad</option>
                        </select>
                    </div>

                    <!-- Asteroid Parameters -->
                    <div class="control-group">
                        <label for="mit-diameter">Di√°metro (m)</label>
                        <input type="range" id="mit-diameter" min="50" max="500" value="150" step="10">
                        <span id="mit-diameter-value" class="value-display">150 m</span>
                    </div>

                    <div class="control-group">
                        <label for="mit-velocity">Velocidad (km/s)</label>
                        <input type="range" id="mit-velocity" min="10" max="40" value="25" step="1">
                        <span id="mit-velocity-value" class="value-display">25 km/s</span>
                    </div>

                    <!-- Mission Parameters -->
                    <div class="control-group">
                        <label for="time-before-impact">Tiempo (d√≠as)</label>
                        <input type="range" id="time-before-impact" min="30" max="3650" value="365" step="30">
                        <span id="time-before-impact-value" class="value-display">365 d√≠as</span>
                    </div>

                    <div id="kinetic-params" class="strategy-params">
                        <div class="control-group">
                            <label for="impactor-mass">Masa Impactador (kg)</label>
                            <input type="range" id="impactor-mass" min="100" max="10000" value="1000" step="100">
                            <span id="impactor-mass-value" class="value-display">1000 kg</span>
                        </div>

                        <div class="control-group">
                            <label for="impactor-velocity">Velocidad Impactador (km/s)</label>
                            <input type="range" id="impactor-velocity" min="5" max="20" value="10" step="1">
                            <span id="impactor-velocity-value" class="value-display">10 km/s</span>
                        </div>
                    </div>

                    <button id="deflection-btn" class="btn-primary">Calcular Deflexi√≥n</button>
                </div>

                <!-- Deflection Results -->
                <div class="results-preview">
                    <div id="deflection-results" class="results-content">
                        <div class="placeholder">Ejecute una simulaci√≥n de deflexi√≥n para ver los resultados</div>
                    </div>
                </div>

            </div>
        </aside>

        <!-- Map Container -->
        <main class="map-main">
            <div id="map-container" class="map-container"></div>

            <!-- Map Legend -->
            <div class="map-legend">
                <div class="legend-item">
                    <span class="legend-dot destruction"></span>
                    <span>Destrucci√≥n Total</span>
                </div>
                <div class="legend-item">
                    <span class="legend-dot damage"></span>
                    <span>Da√±o Severo</span>
                </div>
                <div class="legend-item">
                    <span class="legend-dot affected"></span>
                    <span>√Årea Afectada</span>
                </div>
            </div>
        </main>
    </div>

    <!-- Loading Overlay con Animaci√≥n 3D -->
    <div id="loading-overlay" class="loading-overlay" style="display: none;">
        <div id="loading-3d-container" class="loading-3d-container"></div>
        <!-- Indicador de progreso de carga de datos -->
        <div id="loading-progress-indicator" class="loading-progress-indicator">
            <div class="progress-content">
                <div class="progress-spinner"></div>
                <h3 id="loading-status-text">Cargando...</h3>
                <div class="progress-bar-container">
                    <div id="progress-bar" class="progress-bar"></div>
                </div>
                <div id="loading-steps" class="loading-steps">
                    <div class="loading-step" data-step="impact">
                        <span class="step-icon">‚è≥</span>
                        <span class="step-text">Impacto</span>
                        <span class="step-status">...</span>
                    </div>
                    <div class="loading-step" data-step="population">
                        <span class="step-icon">‚è≥</span>
                        <span class="step-text">Poblaci√≥n</span>
                        <span class="step-status">...</span>
                    </div>
                    <div class="loading-step" data-step="flora-fauna">
                        <span class="step-icon">‚è≥</span>
                        <span class="step-text">Especies</span>
                        <span class="step-status">...</span>
                    </div>
                    <div class="loading-step" data-step="complete">
                        <span class="step-icon">‚è≥</span>
                        <span class="step-text">Finalizando</span>
                        <span class="step-status">...</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Results Modal -->
    <div id="results-modal" class="results-modal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Resultados Completos del Impacto</h2>
                <button class="modal-close" onclick="closeResultsModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div id="modal-results-content"></div>
            </div>
            <div class="modal-footer">
                <button class="btn-secondary" onclick="closeResultsModal()">Cerrar</button>
            </div>
        </div>
    </div>

    <!-- Deflection Results Modal -->
    <div id="deflection-modal" class="results-modal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h2>üöÄ An√°lisis Completo de Estrategias de Mitigaci√≥n</h2>
                <button class="modal-close" onclick="closeDeflectionModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div id="modal-deflection-content"></div>
            </div>
            <div class="modal-footer">
                <button class="btn-secondary" onclick="closeDeflectionModal()">Cerrar</button>
            </div>
        </div>
    </div>

    <!-- Rewards Modal -->
    <div id="rewards-modal" class="results-modal" style="display: none;">
        <div class="modal-content rewards-modal-content">
             <div class="modal-header">
                 <h2>Centro de Recompensas</h2>
                 <button class="modal-close" onclick="closeModal('rewards-modal')">&times;</button>
             </div>
            <div class="modal-body">
                <!-- Stats Overview -->
                <div class="rewards-stats">
                    <div class="stat-card">
                        <div class="stat-icon">‚òÖ</div>
                        <div class="stat-value" id="total-points">0</div>
                        <div class="stat-label">Puntos Totales</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">‚ô¶</div>
                        <div class="stat-value" id="achievements-count">0</div>
                        <div class="stat-label">Logros</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">‚ñ∫</div>
                        <div class="stat-value" id="simulations-count">0</div>
                        <div class="stat-label">Simulaciones</div>
                    </div>
                </div>

                 <!-- Achievements Section -->
                 <div class="achievements-section">
                     <h3>Logros Desbloqueados</h3>
                    <div class="achievements-grid" id="achievements-grid">
                        <!-- Achievements will be populated here -->
                    </div>
                </div>

                 <!-- Challenges Section -->
                 <div class="challenges-section">
                     <h3>Desaf√≠os Activos</h3>
                    <div class="challenges-list" id="challenges-list">
                        <!-- Challenges will be populated here -->
                    </div>
                </div>

                 <!-- Special Modes -->
                 <div class="special-modes-section">
                     <h3>Modos Especiales</h3>
                     <div class="modes-grid">
                         <button class="mode-card" onclick="activateSpecialMode('apocalypse')">
                             <div class="mode-title">Modo Apocalipsis</div>
                             <div class="mode-desc">Asteroides masivos</div>
                         </button>
                         <button class="mode-card" onclick="activateSpecialMode('defender')">
                             <div class="mode-title">Modo Defensor</div>
                             <div class="mode-desc">Salva la Tierra</div>
                         </button>
                         <button class="mode-card" onclick="activateSpecialMode('scientist')">
                             <div class="mode-title">Modo Cient√≠fico</div>
                             <div class="mode-desc">Datos precisos</div>
                         </button>
                     </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn-secondary" onclick="closeModal('rewards-modal')">Cerrar</button>
            </div>
        </div>
    </div>

    <!-- Asteroid Info Modal -->
    <div id="asteroid-info-modal" class="results-modal" style="display: none;">
        <div class="modal-content rewards-modal-content">
             <div class="modal-header">
                 <h2>Base de Datos de Asteroides NASA</h2>
                <button class="modal-close" onclick="closeModal('asteroid-info-modal')">&times;</button>
            </div>
            <div class="modal-body">
                <div class="asteroid-search">
                    <input type="text" id="asteroid-search-input" placeholder="Buscar asteroide por nombre o ID..." style="width: 100%; padding: 1rem; margin-bottom: 1rem; border-radius: 8px; border: 1px solid var(--input-border); background: var(--input-bg); color: var(--text-light);">
                     <button onclick="searchAsteroid()" class="btn-primary" style="width: 100%; margin-bottom: 2rem;">Buscar Asteroide</button>
                </div>
                
                <div class="asteroid-list" id="asteroid-list">
                    <!-- Lista de asteroides ser√° poblada aqu√≠ -->
                </div>
                
                <div class="asteroid-details" id="asteroid-details" style="display: none;">
                    <!-- Detalles del asteroide seleccionado -->
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn-secondary" onclick="closeModal('asteroid-info-modal')">Cerrar</button>
            </div>
        </div>
    </div>

    <!-- Tutorial Modal -->
    <div id="tutorial-modal" class="results-modal" style="display: none;">
        <div class="modal-content rewards-modal-content">
             <div class="modal-header">
                 <h2>Tutorial del Simulador</h2>
                <button class="modal-close" onclick="closeModal('tutorial-modal')">&times;</button>
            </div>
            <div class="modal-body">
                <div class="tutorial-steps">
                     <div class="tutorial-step active" data-step="1">
                         <h3>Paso 1: Configurar Par√°metros</h3>
                         <p>Ajusta el di√°metro, velocidad y √°ngulo de entrada del asteroide. Usa los controles deslizantes para experimentar con diferentes valores.</p>
                     </div>
                     
                     <div class="tutorial-step" data-step="2">
                         <h3>Paso 2: Seleccionar Ubicaci√≥n</h3>
                         <p>Haz clic en el mapa para elegir el punto de impacto. El simulador calcular√° autom√°ticamente los efectos en esa ubicaci√≥n.</p>
                     </div>
                     
                     <div class="tutorial-step" data-step="3">
                         <h3>Paso 3: Ejecutar Simulaci√≥n</h3>
                         <p>Presiona "Simular Impacto" para ver los resultados. El sistema calcular√° energ√≠a, da√±os y efectos secundarios.</p>
                     </div>
                     
                     <div class="tutorial-step" data-step="4">
                         <h3>Paso 4: Estrategias de Mitigaci√≥n</h3>
                         <p>Cambia al modo mitigaci√≥n para explorar c√≥mo desviar asteroides usando diferentes t√©cnicas cient√≠ficas.</p>
                     </div>
                </div>
                
                <div class="tutorial-navigation">
                    <button class="btn-secondary" onclick="previousTutorialStep()">‚Üê Anterior</button>
                    <span id="tutorial-progress">1 de 4</span>
                    <button class="btn-primary" onclick="nextTutorialStep()">Siguiente ‚Üí</button>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn-secondary" onclick="closeModal('tutorial-modal')">Cerrar</button>
            </div>
        </div>
    </div>

    <!-- Settings Modal -->
    <div id="settings-modal" class="results-modal" style="display: none;">
        <div class="modal-content rewards-modal-content">
            <div class="modal-header">
                 <h2>Configuraci√≥n Avanzada</h2>
                <button class="modal-close" onclick="closeModal('settings-modal')">&times;</button>
            </div>
            <div class="modal-body">
                 <div class="settings-section">
                     <h3>Apariencia</h3>
                     <div class="setting-item">
                         <label>Tema:</label>
                         <select id="theme-select">
                             <option value="dark">Oscuro</option>
                             <option value="light">Claro</option>
                             <option value="auto">Autom√°tico</option>
                         </select>
                     </div>
                     <div class="setting-item">
                         <label>Idioma:</label>
                         <select id="language-select">
                             <option value="es">Espa√±ol</option>
                             <option value="en">English</option>
                             <option value="fr">Fran√ßais</option>
                             <option value="de">Deutsch</option>
                         </select>
                     </div>
                 </div>
                 
                 <div class="settings-section">
                     <h3>Simulaci√≥n</h3>
                    <div class="setting-item">
                        <label>Precisi√≥n de c√°lculos:</label>
                        <select id="precision-select">
                            <option value="low">Baja (R√°pido)</option>
                            <option value="medium" selected>Media (Balanceado)</option>
                            <option value="high">Alta (Preciso)</option>
                        </select>
                    </div>
                    <div class="setting-item">
                        <label>Mostrar datos t√©cnicos:</label>
                        <input type="checkbox" id="technical-data" checked>
                    </div>
                </div>
                
                 <div class="settings-section">
                     <h3>APIs</h3>
                    <div class="setting-item">
                        <label>NASA API Key:</label>
                        <input type="password" id="nasa-api-key" placeholder="Tu API key de NASA">
                    </div>
                    <div class="setting-item">
                        <label>Cache de datos:</label>
                        <input type="checkbox" id="data-cache" checked>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn-secondary" onclick="resetSettings()">Restablecer</button>
                <button class="btn-primary" onclick="saveSettings()">Guardar</button>
                <button class="btn-secondary" onclick="closeModal('settings-modal')">Cerrar</button>
            </div>
        </div>
    </div>

    <!-- Stats Modal -->
    <div id="stats-modal" class="results-modal" style="display: none;">
        <div class="modal-content rewards-modal-content">
            <div class="modal-header">
                 <h2>Estad√≠sticas Detalladas</h2>
                <button class="modal-close" onclick="closeModal('stats-modal')">&times;</button>
            </div>
            <div class="modal-body">
                <div class="stats-grid">
                     <div class="stat-section">
                         <h3>Simulaciones</h3>
                        <div class="stat-item">
                            <span class="stat-label">Total:</span>
                            <span class="stat-value" id="total-simulations">0</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-label">Esta sesi√≥n:</span>
                            <span class="stat-value" id="session-simulations">0</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-label">Mayor energ√≠a:</span>
                            <span class="stat-value" id="max-energy">0 MT</span>
                        </div>
                    </div>
                    
                     <div class="stat-section">
                         <h3>Ubicaciones</h3>
                        <div class="stat-item">
                            <span class="stat-label">Continentes explorados:</span>
                            <span class="stat-value" id="continents-explored">0</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-label">Ciudades impactadas:</span>
                            <span class="stat-value" id="cities-impacted">0</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-label">Oc√©anos:</span>
                            <span class="stat-value" id="oceans-impacted">0</span>
                        </div>
                    </div>
                    
                     <div class="stat-section">
                         <h3>Efectos</h3>
                        <div class="stat-item">
                            <span class="stat-label">Tsunamis simulados:</span>
                            <span class="stat-value" id="tsunamis-simulated">0</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-label">Terremotos:</span>
                            <span class="stat-value" id="earthquakes-simulated">0</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-label">Efectos clim√°ticos:</span>
                            <span class="stat-value" id="climate-effects">0</span>
                        </div>
                    </div>
                </div>
                
                 <div class="stats-chart">
                     <h3>Gr√°fico de Actividad</h3>
                     <div id="activity-chart" style="height: 200px; background: var(--input-bg); border-radius: 8px; display: flex; align-items: center; justify-content: center; color: var(--text-medium);">
                         Gr√°fico de actividad por d√≠a
                     </div>
                 </div>
            </div>
            <div class="modal-footer">
                 <button class="btn-secondary" onclick="exportStats()">Exportar</button>
                <button class="btn-secondary" onclick="closeModal('stats-modal')">Cerrar</button>
            </div>
        </div>
    </div>

    <!-- Asteroids Browser Modal -->
    <div id="asteroids-browser-modal" class="results-modal" style="display: none;">
        <div class="modal-content asteroids-browser-content">
            <div class="modal-header">
                 <h2>Explorador de Asteroides NASA</h2>
                <button class="modal-close" onclick="closeAsteroidsBrowser()">&times;</button>
            </div>
            <div class="modal-body" style="max-height: 70vh; overflow-y: auto;">
                <div id="asteroids-list-content"></div>
            </div>
            <div class="modal-footer">
                <button class="btn-secondary" onclick="closeAsteroidsBrowser()">Cerrar</button>
            </div>
        </div>
    </div>

    <!-- Asteroid Detail Modal -->
    <div id="asteroid-detail-modal" class="results-modal" style="display: none; z-index: 200000 !important;">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="asteroid-detail-title">Detalles del Asteroide</h2>
                <button class="modal-close" onclick="closeAsteroidDetail()">&times;</button>
            </div>
            <div class="modal-body" style="max-height: 70vh; overflow-y: auto;">
                <div id="asteroid-detail-content"></div>
            </div>
            <div class="modal-footer">
                <button class="btn-primary" onclick="useAsteroidInSimulation()">Usar en Simulaci√≥n</button>
                <button class="btn-secondary" onclick="closeAsteroidDetail()">Cerrar</button>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    
    <!-- Three.js para animaci√≥n 3D de carga -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/OrbitControls.js"></script>
    <script src="{{ url_for('static', filename='js/loading-3d.js') }}"></script>
    
    <script src="{{ url_for('static', filename='js/i18n.js') }}"></script>
    <script src="{{ url_for('static', filename='js/main.js') }}"></script>
</body>

</html>